---
description: 
globs: 
alwaysApply: true
---
# MEDINOTE - Cursor Rules GÃ©nÃ©rales

## ğŸ—ï¸ Architecture du Projet

**Medinote** est une application Next.js 14 de prise de notes mÃ©dicales avec les caractÃ©ristiques suivantes :

### Technologies Principales
- **Framework:** Next.js 14.2.3 avec App Router
- **Language:** TypeScript (strict mode)
- **Styling:** Tailwind CSS avec configuration personnalisÃ©e
- **Base de donnÃ©es:** Prisma ORM avec PostgreSQL
- **Authentification:** NextAuth.js v5 (beta)
- **State Management:** Zustand + React Query (TanStack)
- **UI Components:** Radix UI + shadcn/ui
- **Rich Text:** Tiptap Editor
- **AI Integration:** OpenAI API (GPT-4, Whisper)
- **File Upload:** AWS S3
- **Email:** Resend
- **Signatures:** YouSign

### Structure des Dossiers

```
app/                    # App Router de Next.js
â”œâ”€â”€ (global-layout)/    # Route group avec sidebar
â”œâ”€â”€ api/               # API Routes
â”œâ”€â”€ auth/              # Pages d'authentification
â””â”€â”€ providers.tsx      # React Providers

src/
â”œâ”€â”€ components/        # Composants UI rÃ©utilisables
â”œâ”€â”€ features/         # FonctionnalitÃ©s mÃ©tier par domaine
â”œâ”€â”€ hooks/            # Custom React hooks
â”œâ”€â”€ lib/              # Utilitaires et configurations
â”œâ”€â”€ store/            # Zustand stores
â””â”€â”€ types/            # DÃ©finitions TypeScript

prisma/
â””â”€â”€ schema/           # ModÃ¨les Prisma sÃ©parÃ©s par domaine
```

## ğŸ“‹ RÃ¨gles de DÃ©veloppement GÃ©nÃ©rales

### 1. Convention de Nommage
- **Fichiers:** camelCase pour les fichiers utilitaires, PascalCase pour les composants
- **Composants:** PascalCase (ex: `DocumentBuilder.tsx`)
- **Hooks:** PrÃ©fixe "use" (ex: `useDocumentBuilder.ts`)
- **Actions:** Suffixe ".actions.ts" (ex: `document.actions.ts`)
- **Types:** Suffixe ".types.ts" ou dans dossier `types/`
- **Schemas:** Suffixe ".schema.ts" (ex: `profil-schema.ts`)

### 2. Structure des Composants
```typescript
// Pattern standard pour les composants
import { FC } from "react";
import { cn } from "@/lib/utils";

interface ComponentProps {
  className?: string;
  // Props spÃ©cifiques
}

export const Component: FC<ComponentProps> = ({ 
  className,
  ...props 
}) => {
  return (
    <div className={cn("base-classes", className)}>
      {/* Contenu */}
    </div>
  );
};
```

### 3. Gestion d'Ã‰tat
- **Ã‰tat local:** `useState`, `useReducer`
- **Ã‰tat global:** Zustand stores dans `src/store/`
- **Cache serveur:** React Query (TanStack Query)
- **Formulaires:** React Hook Form + Zod validation

### 4. Authentification
- Utiliser NextAuth.js v5 avec stratÃ©gie database
- Session enrichie avec donnÃ©es utilisateur complÃ¨tes
- Middleware pour protection des routes
- Hook `useUser()` pour accÃ©der aux donnÃ©es utilisateur

### 5. API et Server Actions
- PrivilÃ©gier les Server Actions pour les mutations
- API Routes pour les endpoints complexes et webhooks
- Validation avec Zod schemas
- Gestion d'erreurs avec `ActionError`

## ğŸ¨ Standards UI/UX

### Design System
- **Couleurs principales:** 
  - Primary Blue: #2684ff
  - Secondary Blue: #0054CF
  - Primary Green: #08dbb3
  - Background: #F7FAFC
- **Font:** Poppins
- **Composants:** shadcn/ui avec Radix UI
- **Animations:** Tailwind CSS + Framer Motion
- **Shadow:** Style Apple avec `shadow-apple`

### Responsive Design
- Mobile-first approach
- Breakpoints Tailwind standards
- Sidebar responsive (mobile drawer)

## ğŸ” SÃ©curitÃ©

### RÃ¨gles de SÃ©curitÃ©
1. Toujours valider les donnÃ©es cÃ´tÃ© serveur avec Zod
2. Utiliser CSRF protection via NextAuth
3. Sanitiser les inputs utilisateur
4. VÃ©rifier les permissions avant chaque action
5. Never expose sensitive data in client components

### Variables d'Environnement
```typescript
// Utiliser @t3-oss/env-nextjs pour validation
export const env = createEnv({
  server: {
    NEXTAUTH_SECRET: z.string(),
    DATABASE_URL: z.string(),
    OPENAI_API_KEY: z.string(),
    // ...
  },
  client: {
    // Variables client si nÃ©cessaire
  },
});
```

## ğŸ“ Bonnes Pratiques React 2025

### 1. Performance
- Utiliser `React.memo` pour les composants coÃ»teux
- `useMemo` et `useCallback` pour optimiser les re-renders
- Lazy loading avec `React.lazy` et `Suspense`
- Code splitting au niveau des routes

### 2. Server Components
- PrivilÃ©gier les Server Components par dÃ©faut
- Marquer "use client" uniquement quand nÃ©cessaire
- Ã‰viter les props drilling avec Server Components

### 3. Concurrent Features
- Utiliser `useTransition` pour les updates non-urgentes
- `useDeferredValue` pour les listes filtrable
- Suspense boundaries pour le loading states

### 4. Error Handling
```typescript
// Error Boundary pattern
"use client";
import { ErrorBoundary } from "react-error-boundary";

function ErrorFallback({error, resetErrorBoundary}) {
  return (
    <div role="alert">
      <h2>Something went wrong:</h2>
      <pre>{error.message}</pre>
      <button onClick={resetErrorBoundary}>Try again</button>
    </div>
  );
}

// Usage
<ErrorBoundary FallbackComponent={ErrorFallback}>
  <SomeComponent />
</ErrorBoundary>
```

## ğŸš€ Standards de QualitÃ©

### TypeScript
- Mode strict activÃ©
- Pas de `any`, utiliser `unknown` si nÃ©cessaire
- Interfaces pour les props, types pour les unions
- GÃ©nÃ©riques pour la rÃ©utilisabilitÃ©

### ESLint & Prettier
- Configuration Next.js standard
- Auto-fix activÃ©
- Format on save

### Testing (Ã€ implÃ©menter)
- Jest + React Testing Library
- Tests unitaires pour les utilities
- Tests d'intÃ©gration pour les composants critiques
- E2E tests avec Playwright

## ğŸ”„ Workflow Git

### Convention de Commits
```
feat: nouvelle fonctionnalitÃ©
fix: correction de bug
docs: documentation
style: formatting
refactor: refactoring code
test: ajout de tests
chore: maintenance
```

### Branches
- `main`: production
- `develop`: dÃ©veloppement
- `feature/nom-feature`: nouvelles fonctionnalitÃ©s
- `fix/nom-bug`: corrections

## ğŸ“¦ DÃ©ploiement

### Production
- Build optimisÃ© avec `next build`
- Migrations Prisma automatiques
- Seed des donnÃ©es de base
- Variables d'environnement validÃ©es

### Monitoring
- Console.log pour development
- Structured logging avec tslog en production
- Error tracking (Ã  implÃ©menter)
